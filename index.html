<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dilution Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 44px 24px 24px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 24px;
            color: #333;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath fill='%23666' d='M0 0l6 8 6-8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        .input-group {
            display: flex;
            gap: 8px;
            align-items: stretch;
            width: 100%;
        }

        input[type="number"] {
            flex: 1;
            min-width: 0;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #007AFF;
        }

        .unit-toggle {
            display: flex;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .unit-toggle button {
            padding: 12px 16px;
            border: none;
            border-right: 2px solid #ddd;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.2s;
        }

        .unit-toggle button:last-child {
            border-right: none;
        }

        .unit-toggle button.active {
            background: #007AFF;
            color: white;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 24px;
        }

        .calculate-btn:active {
            background: #0056b3;
        }

        .results {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
        }

        .result-item {
            margin-bottom: 12px;
            padding: 12px;
            background: white;
            border-radius: 6px;
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dilution Calculator</h1>

        <div class="form-group">
            <label for="ratio">Dilution Ratio</label>
            <select id="ratio">
                <option value="2">2:1 (Vinegar)</option>
                <option value="10" selected>10:1 (Meguiar's)</option>
                <option value="16">16:1 (ONR)</option>
                <option value="250">250:1 (Ritzpaz)</option>
            </select>
        </div>

        <div class="form-group">
            <label>Total Container Volume</label>
            <div class="unit-toggle" style="width: 100%;">
                <button class="active" data-volume="16" data-unit="oz" style="flex: 1;">16 oz</button>
                <button data-volume="32" data-unit="oz" style="flex: 1;">32 oz</button>
                <button data-volume="2000" data-unit="ml" style="flex: 1;">2 L</button>
            </div>
        </div>

        <div class="form-group">
            <label for="currentVolume">Volume Already in Container</label>
            <div class="input-group">
                <input type="number" id="currentVolume" value="0" min="0" step="any">
                <div class="unit-toggle">
                    <button class="active" data-unit="oz" data-field="current">oz</button>
                    <button data-unit="ml" data-field="current">mL</button>
                </div>
            </div>
        </div>

        <button class="calculate-btn" onclick="calculate()">Calculate</button>

        <div class="results" id="results">
            <h2>Add to Container:</h2>
            <div class="result-item">
                <div class="result-label">Active Ingredient</div>
                <div class="result-value" id="ingredient"></div>
            </div>
            <div class="result-item">
                <div class="result-label">Water</div>
                <div class="result-value" id="water"></div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            totalVolume: 16,
            totalUnit: 'oz',
            currentUnit: 'oz'
        };

        // Handle unit toggle buttons
        document.querySelectorAll('.unit-toggle button').forEach(button => {
            button.addEventListener('click', function() {
                const field = this.dataset.field;
                const unit = this.dataset.unit;
                const volume = this.dataset.volume;

                // Update active state
                this.parentElement.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');

                // Update state
                if (volume) {
                    // Total volume toggle
                    state.totalVolume = parseFloat(volume);
                    state.totalUnit = unit;
                } else if (field === 'current') {
                    state.currentUnit = unit;
                }
            });
        });

        function ozToMl(oz) {
            return oz * 29.5735;
        }

        function mlToOz(ml) {
            return ml / 29.5735;
        }

        function calculate() {
            const ratio = parseFloat(document.getElementById('ratio').value);
            let currentVolume = parseFloat(document.getElementById('currentVolume').value);

            if (isNaN(currentVolume)) {
                currentVolume = 0;
            }

            // Convert to mL for calculation
            const totalMl = state.totalUnit === 'oz' ? ozToMl(state.totalVolume) : state.totalVolume;
            const currentMl = state.currentUnit === 'oz' ? ozToMl(currentVolume) : currentVolume;

            if (currentMl >= totalMl) {
                alert('Current volume must be less than total volume');
                return;
            }

            // Calculate needed volume to add
            const neededMl = totalMl - currentMl;

            // Calculate ingredient and water amounts
            // For X:1 ratio, ingredient is 1/(X+1) and water is X/(X+1)
            const ingredientMl = neededMl / (ratio + 1);
            const waterMl = neededMl * (ratio / (ratio + 1));

            // Convert to oz
            const ingredientOz = mlToOz(ingredientMl);
            const waterOz = mlToOz(waterMl);

            // Display results
            document.getElementById('ingredient').textContent = `${ingredientOz.toFixed(1)} oz (${ingredientMl.toFixed(1)} mL)`;
            document.getElementById('water').textContent = `${waterOz.toFixed(1)} oz (${waterMl.toFixed(1)} mL)`;

            document.getElementById('results').classList.add('show');
        }

        // Allow Enter key to calculate
        document.getElementById('currentVolume').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculate();
        });
    </script>
</body>
</html>
